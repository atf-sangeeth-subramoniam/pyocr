<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload to S3</title>
    <script>
        function runOCR(key, textareaId) {
            fetch("/ocr", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ key: key })
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error("Server error: " + text);
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    alert("OCR Error: " + data.error);
                } else {
                    document.getElementById(textareaId).value = data.ocr_text;
                }
            })
            .catch(err => {
                alert("Error running OCR: " + err.message);
            });
        }
    </script>
</head>
<body>
    <h1>Upload Image to S3</h1>

    <form action="/" method="post" enctype="multipart/form-data">
        <input type="file" name="file" required>
        <input type="submit" value="Upload">
    </form>

    {% if images %}
        <h2>All Uploaded Images:</h2>
        {% for img in images %}
            <div style="margin-bottom: 30px;">
                <img src="{{ img.url }}" alt="Image" width="300" style="display:block; margin:10px 0;">
                <button onclick="runOCR('{{ img.key }}', 'textarea_{{ loop.index }}')">Run OCR</button>
                <br>
                <textarea id="textarea_{{ loop.index }}" rows="5" cols="50" readonly></textarea>
            </div>
        {% endfor %}
    {% else %}
        <p>No images uploaded yet.</p>
    {% endif %}
</body>
</html>
